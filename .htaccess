<IfModule mod_rewrite.c>
    RewriteEngine On

    # FORCE HTTPS (works behind any proxy)
    RewriteCond %{HTTP:X-Forwarded-Proto} !https [NC]
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301,NE]

    # Route all requests to /public
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# CORS fallback for any HTTP asset (prevents CORS error if mixed content slips through)
<IfModule mod_headers.c>
    <FilesMatch "\.(css|js|woff2?|ttf|eot|svg|png|jpe?g|gif|ico|json)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</IfModule>

# Security
Options -Indexes
<Files .env>
    Order allow,deny
    Deny from all
</Files>
